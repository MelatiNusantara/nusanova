<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kalkulator Kelayakan Usaha Tani Padi</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --pacific-blue:#1B365D; --sustainable-teal:#2D7D7D; --coral-innovation:#FF6B47;
      --pearl-white:#F8F9FA; --pearl-light:#FFFFFF; --text-secondary:#666; --border-light:#E8F4F8;
    }
    *{box-sizing:border-box}
    body{
      font-family: "Segoe UI", Tahoma, sans-serif;
      background:var(--pearl-white);
      margin:0;
      padding:20px;
      color:var(--pacific-blue);
    }
    .container{
      max-width:960px;
      margin:auto;
      background:var(--pearl-light);
      padding:36px;
      border-radius:14px;
      box-shadow:0 8px 25px rgba(0,0,0,0.08);
    }
    h1{text-align:center;color:var(--pacific-blue);font-size:28px;margin-bottom:20px}
    h2{color:var(--sustainable-teal);border-left:6px solid var(--coral-innovation);padding-left:12px;margin:28px 0 14px;font-size:20px}
    h3{font-size:16px;color:var(--pacific-blue);margin:12px 0}
    .input-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-bottom:18px}
    .input-group{display:flex;flex-direction:column}
    label{margin-bottom:4px;font-weight:600;font-size:14px;color:var(--pacific-blue)}
    small{display:block;color:var(--text-secondary);font-size:12px;margin-bottom:6px}
    input{padding:10px;border:1px solid var(--border-light);border-radius:8px;font-size:15px;transition:border-color .2s}
    input:focus{outline:none;border-color:var(--sustainable-teal)}
    button{display:block;width:100%;padding:14px;background:var(--coral-innovation);color:#fff;border:none;border-radius:8px;font-size:17px;font-weight:700;cursor:pointer;margin-top:12px}
    button:hover{background:#e25838}
    .output-section{margin-top:22px;padding:18px;border-radius:12px;background:var(--pearl-white);border:1px solid var(--border-light);display:none}
    .output-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:14px}
    .result-card{background:var(--pearl-light);padding:16px;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,0.05);border-top:4px solid var(--sustainable-teal)}
    .result-card h3{margin:0 0 10px}
    .result-card p{margin:6px 0;font-size:15px;font-weight:700;color:#333}
    .result-card .label{display:block;font-size:12px;font-weight:400;color:var(--text-secondary)}
    .summary-card{grid-column:1/-1;border-top-color:var(--coral-innovation)}
    .good{color:#27ae60}.bad{color:#e74c3c}
    .packaging-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-top:8px}
    .packaging-grid label{font-size:13px;margin-bottom:6px}
    .packaging-grid input{padding:8px}
    @media(max-width:720px){.output-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>üåæ Kalkulator Kelayakan Usaha Tani Padi</h1>

    <!-- FORM ON-FARM -->
    <form id="farmCalculator" onsubmit="return false;">
      <h2>üå± Parameter Lahan & Produksi</h2>
      <div class="input-grid">
        <div class="input-group">
          <label for="luasLahan">Luas Cluster (ha)</label>
          <small>Total luas lahan yang dikelola (hektar)</small>
          <input type="number" id="luasLahan" value="870.5" step="0.1" required>
        </div>

        <div class="input-group">
          <label for="produktivitasGKP">Produktivitas GKP (ton/ha)</label>
          <small>GKP = <b>Gabah Kering Panen</b> (gabah hasil panen, kadar air ‚âà 20‚Äì25%)</small>
          <input type="number" id="produktivitasGKP" value="5" step="0.1" required>
        </div>

        <div class="input-group">
          <label for="indexTanam">Index Tanam (kali/tahun)</label>
          <small>Jumlah siklus tanam per tahun (mis. 2 = tanam 2 kali/tahun)</small>
          <input type="number" id="indexTanam" value="2" step="1" required>
        </div>
      </div>

      <h2>üí∞ Parameter Biaya On-Farm (per ha per siklus)</h2>
      <div class="input-grid">
        <div class="input-group">
          <label for="biayaTenagaKerja">Tenaga Kerja</label>
          <small>Upah buruh untuk budidaya per ha per siklus</small>
          <input type="text" id="biayaTenagaKerja" class="format-number" value="5200000" required>
        </div>

        <div class="input-group">
          <label for="biayaLogistik">Logistik</label>
          <small>Transport & logistik input/hasil (per ha per siklus)</small>
          <input type="text" id="biayaLogistik" class="format-number" value="3054000" required>
        </div>

        <div class="input-group">
          <label for="biayaSewa">Sewa/Borongan</label>
          <small>Sewa lahan atau biaya borongan (per ha per siklus)</small>
          <input type="text" id="biayaSewa" class="format-number" value="5000000" required>
        </div>

        <div class="input-group">
          <label for="biayaAdmin">Administrasi</label>
          <small>Biaya administrasi & operasional kecil</small>
          <input type="text" id="biayaAdmin" class="format-number" value="371112" required>
        </div>

        <div class="input-group">
          <label for="hargaGKP">Harga Jual GKP (Rp/kg)</label>
          <small>Harga jual Gabah Kering Panen per kilogram</small>
          <input type="text" id="hargaGKP" class="format-number" value="4500" required>
        </div>
      </div>

      <button type="button" onclick="calculate()">Hitung Kelayakan Awal</button>
    </form>

    <!-- OUTPUT ON-FARM -->
    <div id="outputSection" class="output-section">
      <h2>üìä Hasil Analisis On-Farm</h2>
      <div class="output-grid">
        <div class="result-card" id="outputPerHektar"></div>
        <div class="result-card" id="outputTotalCluster"></div>
      </div>
    </div>

    <!-- MILLING & PACKAGING -->
    <div id="millingSection" class="output-section">
      <h2>üè≠ Parameter Penggilingan & Penjualan</h2>
      <small style="display:block;margin-bottom:12px;color:var(--text-secondary)">
        GKG = <b>Gabah Kering Giling</b> (setelah pengeringan ideal ‚âà 14% air). Rendemen menunjukkan persentase konversi antar tahap.
      </small>

      <div class="input-grid">
        <div class="input-group">
          <label for="rendemenGKG">Rendemen GKP ‚ûú GKG (%)</label>
          <small>Persentase GKG yang diperoleh dari GKP setelah pengeringan</small>
          <input type="number" id="rendemenGKG" value="86.02" step="0.01" required>
        </div>

        <div class="input-group">
          <label for="rendemenBeras">Rendemen GKG ‚ûú Beras (%)</label>
          <small>Persentase beras yang diperoleh dari GKG setelah penggilingan</small>
          <input type="number" id="rendemenBeras" value="62.74" step="0.01" required>
        </div>

        <div class="input-group">
          <label for="proporsiMedium">Proporsi Beras Medium (%)</label>
          <small>Persentase beras yang masuk kualitas medium</small>
          <input type="number" id="proporsiMedium" value="75" step="1" required>
        </div>

        <div class="input-group">
          <label for="proporsiPremium">Proporsi Beras Premium (%)</label>
          <small>Persentase beras yang masuk kualitas premium</small>
          <input type="number" id="proporsiPremium" value="25" step="1" required>
        </div>

        <div class="input-group">
          <label for="biayaProses">Biaya Proses (Rp/kg GKP)</label>
          <small>Biaya penggilingan + tenaga + listrik per kg GKP</small>
          <input type="text" id="biayaProses" class="format-number" value="700" required>
        </div>
      </div>

      <h3>Harga Jual per Karung (Rp)</h3>
      <div class="packaging-grid">
        <div class="input-group">
          <label for="hargaMedium5">Medium 5kg</label>
          <input type="text" id="hargaMedium5" class="format-number" value="59000" required>
        </div>
        <div class="input-group">
          <label for="hargaMedium10">Medium 10kg</label>
          <input type="text" id="hargaMedium10" class="format-number" value="117000" required>
        </div>
        <div class="input-group">
          <label for="hargaMedium25">Medium 25kg</label>
          <input type="text" id="hargaMedium25" class="format-number" value="292500" required>
        </div>
        <div class="input-group">
          <label for="hargaPremium5">Premium 5kg</label>
          <input type="text" id="hargaPremium5" class="format-number" value="64000" required>
        </div>
        <div class="input-group">
          <label for="hargaPremium10">Premium 10kg</label>
          <input type="text" id="hargaPremium10" class="format-number" value="127000" required>
        </div>
        <div class="input-group">
          <label for="hargaPremium25">Premium 25kg</label>
          <input type="text" id="hargaPremium25" class="format-number" value="317500" required>
        </div>
      </div>

      <button type="button" onclick="calculateMilling()">Hitung Analisis Bisnis Lengkap</button>

      <div id="millingOutputContainer" style="display:none;margin-top:18px;">
        <h2>üìà Hasil Akhir Proses Bisnis (Hulu-Hilir)</h2>
        <div class="output-grid">
          <div class="result-card" id="outputMillingResult"></div>
          <div class="result-card" id="outputPackaging"></div>
          <div class="result-card summary-card" id="outputFinancialSummary"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/*
  Catatan implementasi:
  - Input harga/bayar/biaya memiliki class .format-number -> diformat dengan titik ribuan saat tampil,
    tapi untuk perhitungan kita gunakan getNumericValue(id) yang menghapus titik dan mengembalikan angka murni.
  - Semua perhitungan mengikuti logika on-farm dan hilir (penggilingan + pengemasan).
*/

let totalBiaya_tahunan = 0;
let totalKeuntunganOnFarm_tahunan = 0;

function formatAngka(angka){
  return new Intl.NumberFormat('id-ID').format(angka);
}
function formatRupiah(angka){
  // jika angka null/NaN -> 0
  const n = Number.isFinite(Number(angka)) ? Number(angka) : 0;
  return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
}

// Inisialisasi format awal untuk input .format-number
function initFormatNumberInputs(){
  document.querySelectorAll('input.format-number').forEach(input => {
    // bersihkan dulu titik jika ada, lalu format
    const raw = (input.value || '').toString().replace(/\./g, '').replace(/[^0-9]/g, '');
    input.value = raw ? raw.replace(/\B(?=(\d{3})+(?!\d))/g, ".") : '';
    input.addEventListener('input', function(){
      const onlyDigits = this.value.toString().replace(/\./g, '').replace(/[^0-9]/g, '');
      this.value = onlyDigits ? onlyDigits.replace(/\B(?=(\d{3})+(?!\d))/g, ".") : '';
    });
    // ketika user paste (menghindari huruf), normalisasi
    input.addEventListener('paste', function(e){
      setTimeout(()=> {
        const onlyDigits = this.value.toString().replace(/\./g, '').replace(/[^0-9]/g, '');
        this.value = onlyDigits ? onlyDigits.replace(/\B(?=(\d{3})+(?!\d))/g, ".") : '';
      }, 10);
    });
  });
}

// Ambil nilai numerik dari input yang diformat (menghapus titik)
function getNumericValue(id){
  const el = document.getElementById(id);
  if(!el) return 0;
  const v = el.value.toString().replace(/\./g, '').trim();
  return v === '' ? 0 : parseFloat(v);
}

// Hitung on-farm
function calculate(){
  const luasLahan = parseFloat(document.getElementById('luasLahan').value) || 0;
  const produktivitasGKP = parseFloat(document.getElementById('produktivitasGKP').value) || 0;
  const indexTanam = parseFloat(document.getElementById('indexTanam').value) || 0;

  const biayaTenagaKerja = getNumericValue('biayaTenagaKerja');
  const biayaLogistik = getNumericValue('biayaLogistik');
  const biayaSewa = getNumericValue('biayaSewa');
  const biayaAdmin = getNumericValue('biayaAdmin');
  const hargaGKP = getNumericValue('hargaGKP');

  const totalBiaya_perHa = biayaTenagaKerja + biayaLogistik + biayaSewa + biayaAdmin;
  const produksiGKP_kg_perHa = produktivitasGKP * 1000;
  const penerimaan_perHa = produksiGKP_kg_perHa * hargaGKP;
  const keuntungan_perHa = penerimaan_perHa - totalBiaya_perHa;
  const hppGKP_perKg = produksiGKP_kg_perHa ? (totalBiaya_perHa / produksiGKP_kg_perHa) : 0;
  const rcRatio = totalBiaya_perHa ? (penerimaan_perHa / totalBiaya_perHa) : 0;

  const totalProduksiGKP_tahunan = luasLahan * produktivitasGKP * indexTanam; // ton
  totalBiaya_tahunan = luasLahan * totalBiaya_perHa * indexTanam;
  totalKeuntunganOnFarm_tahunan = luasLahan * keuntungan_perHa * indexTanam;

  // tampilkan bagian output & milling
  document.getElementById('outputSection').style.display = 'block';
  document.getElementById('millingSection').style.display = 'block';

  document.getElementById('outputPerHektar').innerHTML = `
    <h3>Analisis per Hektar (per Siklus)</h3>
    <p>${formatRupiah(totalBiaya_perHa)}<span class="label">Total Biaya Budidaya per ha</span></p>
    <p>${formatRupiah(hppGKP_perKg)} / kg<span class="label">HPP GKP per kg</span></p>
    <p class="${rcRatio >= 1 ? 'good' : 'bad'}">${rcRatio.toFixed(2)}<span class="label">R/C Ratio (jika GKP dijual @ ${formatRupiah(hargaGKP)})</span></p>
  `;

  document.getElementById('outputTotalCluster').innerHTML = `
    <h3>Proyeksi Total Cluster (per Tahun)</h3>
    <p>${formatAngka(totalProduksiGKP_tahunan.toFixed(2))} ton<span class="label">Target Produksi GKP Tahunan</span></p>
    <p>${formatRupiah(totalBiaya_tahunan)}<span class="label">Total Biaya Budidaya Tahunan</span></p>
    <p class="good">${formatRupiah(totalKeuntunganOnFarm_tahunan)}<span class="label">Total Keuntungan (jika semua GKP dijual)</span></p>
  `;

  // scroll to result (halus)
  document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
}

// Hitung milling + packaging (hulu-hilir)
function calculateMilling(){
  // Ambil input penting
  const luasLahan = parseFloat(document.getElementById('luasLahan').value) || 0;
  const produktivitasGKP = parseFloat(document.getElementById('produktivitasGKP').value) || 0;
  const indexTanam = parseFloat(document.getElementById('indexTanam').value) || 0;

  const totalGKP_ton = luasLahan * produktivitasGKP * indexTanam; // ton GKP per tahun
  const totalGKP_kg = totalGKP_ton * 1000;

  const rendemenGKG = (parseFloat(document.getElementById('rendemenGKG').value) || 0) / 100;
  const rendemenBeras = (parseFloat(document.getElementById('rendemenBeras').value) || 0) / 100;
  const proporsiMedium = (parseFloat(document.getElementById('proporsiMedium').value) || 0) / 100;
  const proporsiPremium = (parseFloat(document.getElementById('proporsiPremium').value) || 0) / 100;
  const biayaProses = getNumericValue('biayaProses');

  const hargaMedium5 = getNumericValue('hargaMedium5');
  const hargaMedium10 = getNumericValue('hargaMedium10');
  const hargaMedium25 = getNumericValue('hargaMedium25');
  const hargaPremium5 = getNumericValue('hargaPremium5');
  const hargaPremium10 = getNumericValue('hargaPremium10');
  const hargaPremium25 = getNumericValue('hargaPremium25');

  // === produksi setelah proses ===
  const totalGKG_ton = totalGKP_ton * rendemenGKG;
  const totalBeras_ton = totalGKG_ton * rendemenBeras;
  const totalBeras_kg = totalBeras_ton * 1000;

  const totalBerasMedium_kg = totalBeras_kg * proporsiMedium;
  const totalBerasPremium_kg = totalBeras_kg * proporsiPremium;

  // proporsi kemasan per kualitas (asumsi)
  const packMediumProp = { '5kg': 0.25, '10kg': 0.25, '25kg': 0.50 };
  const packPremiumProp = { '5kg': 0.50, '10kg': 0.25, '25kg': 0.25 };

  const karungMedium5 = (totalBerasMedium_kg * packMediumProp['5kg']) / 5;
  const karungMedium10 = (totalBerasMedium_kg * packMediumProp['10kg']) / 10;
  const karungMedium25 = (totalBerasMedium_kg * packMediumProp['25kg']) / 25;

  const karungPremium5 = (totalBerasPremium_kg * packPremiumProp['5kg']) / 5;
  const karungPremium10 = (totalBerasPremium_kg * packPremiumProp['10kg']) / 10;
  const karungPremium25 = (totalBerasPremium_kg * packPremiumProp['25kg']) / 25;

  // === finansial ===
  const totalBiayaProses = totalGKP_kg * biayaProses; // Rp
  const totalBiayaKeseluruhan = totalBiaya_tahunan + totalBiayaProses;
  const hppBeras_perKg = totalBeras_kg ? (totalBiayaKeseluruhan / totalBeras_kg) : 0;

  const pendapatanMedium5 = karungMedium5 * hargaMedium5;
  const pendapatanMedium10 = karungMedium10 * hargaMedium10;
  const pendapatanMedium25 = karungMedium25 * hargaMedium25;
  const pendapatanPremium5 = karungPremium5 * hargaPremium5;
  const pendapatanPremium10 = karungPremium10 * hargaPremium10;
  const pendapatanPremium25 = karungPremium25 * hargaPremium25;

  const totalPendapatanBeras = pendapatanMedium5 + pendapatanMedium10 + pendapatanMedium25 + pendapatanPremium5 + pendapatanPremium10 + pendapatanPremium25;
  const keuntunganAkhir = totalPendapatanBeras - totalBiayaKeseluruhan;

  // Tampilkan
  document.getElementById('millingOutputContainer').style.display = 'block';

  document.getElementById('outputMillingResult').innerHTML = `
    <h3>üì¶ Hasil Produksi Beras (Tahunan)</h3>
    <p>${formatAngka(totalBeras_ton.toFixed(2))} ton<span class="label">Total Beras Dihasilkan</span></p>
    <hr>
    <p>${formatAngka(totalBerasMedium_kg.toFixed(0))} kg<span class="label">Beras Kualitas Medium</span></p>
    <p>${formatAngka(totalBerasPremium_kg.toFixed(0))} kg<span class="label">Beras Kualitas Premium</span></p>
  `;

  document.getElementById('outputPackaging').innerHTML = `
    <h3>üõçÔ∏è Pengemasan & Keuntungan per Sak</h3>
    <b>Kualitas Medium:</b>
    <p>${formatAngka(Math.round(karungMedium5))} sak <span class="label">Untung ${formatRupiah(Math.round(hargaMedium5 - (hppBeras_perKg * 5)))} / sak | Total ${formatRupiah(Math.round(pendapatanMedium5))}</span></p>
    <p>${formatAngka(Math.round(karungMedium10))} sak <span class="label">Untung ${formatRupiah(Math.round(hargaMedium10 - (hppBeras_perKg * 10)))} / sak | Total ${formatRupiah(Math.round(pendapatanMedium10))}</span></p>
    <p>${formatAngka(Math.round(karungMedium25))} sak <span class="label">Untung ${formatRupiah(Math.round(hargaMedium25 - (hppBeras_perKg * 25)))} / sak | Total ${formatRupiah(Math.round(pendapatanMedium25))}</span></p>
    <b>Kualitas Premium:</b>
    <p>${formatAngka(Math.round(karungPremium5))} sak <span class="label">Untung ${formatRupiah(Math.round(hargaPremium5 - (hppBeras_perKg * 5)))} / sak | Total ${formatRupiah(Math.round(pendapatanPremium5))}</span></p>
    <p>${formatAngka(Math.round(karungPremium10))} sak <span class="label">Untung ${formatRupiah(Math.round(hargaPremium10 - (hppBeras_perKg * 10)))} / sak | Total ${formatRupiah(Math.round(pendapatanPremium10))}</span></p>
    <p>${formatAngka(Math.round(karungPremium25))} sak <span class="label">Untung ${formatRupiah(Math.round(hargaPremium25 - (hppBeras_perKg * 25)))} / sak | Total ${formatRupiah(Math.round(pendapatanPremium25))}</span></p>
  `;

  document.getElementById('outputFinancialSummary').innerHTML = `
    <h3>üí∞ Ringkasan Finansial Hulu-Hilir (Tahunan)</h3>
    <p class="good">${formatRupiah(Math.round(totalPendapatanBeras))}<span class="label">Total Pendapatan dari Penjualan Beras</span></p>
    <p class="bad">${formatRupiah(Math.round(totalBiayaKeseluruhan))}<span class="label">Total Biaya (Budidaya + Proses)</span></p>
    <p class="good" style="font-size:20px">${formatRupiah(Math.round(keuntunganAkhir))}<span class="label" style="font-size:12px">ESTIMASI KEUNTUNGAN AKHIR</span></p>
    <hr>
    <p>${formatRupiah(hppBeras_perKg)}<span class="label">HPP Beras per Kg</span></p>
    <p class="good" style="font-size:14px">+ ${formatRupiah(Math.round(keuntunganAkhir - totalKeuntunganOnFarm_tahunan))} <span class="label">Peningkatan Keuntungan (dibanding jual GKP saja)</span></p>
  `;

  // scroll to output hilir
  document.getElementById('millingOutputContainer').scrollIntoView({ behavior: 'smooth' });
}

// init setelah DOM siap
document.addEventListener('DOMContentLoaded', function(){
  initFormatNumberInputs();
  // hide milling until first on-farm calc? keep as initially hidden until calculate() shows it.
  // but if you want milling visible from start, uncomment:
  // document.getElementById('millingSection').style.display = 'block';
});
</script>
</body>
</html>